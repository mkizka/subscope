# リポジトリ同期

ユーザーがサーバー登録する際に、actorの同期ステータスがdirtyならリポジトリ同期処理を行う。

## リポジトリ同期の処理手順(バージョン1)

1. actorのステータスをin-processに
2. subscribersになったユーザーのPDSからレコード一覧を取得
3. レコード一覧の中から以下のレコードを一括保存
4. リポジトリ同期の状況はXRPCクエリで確認出来る。クライアントは定期的にポーリングする
5. actorのステータスをsynchronizedにする

## リポジトリ同期ステータスの定義

- dirty ... 同期されていない
- in-process ... リポジトリ同期のバックグラウンドタスクが進行中
- synchronized ... リポジトリ同期完了

## リポジトリ同期のバージョン定義

今後リポジトリ同期ロジックを更新することを踏まえてリポジトリ同期にバージョンを付与する。
リポジトリ同期開始時にactorは同期ステータスとバージョンを保存する。現在のバージョンは1。
