# レコードのインデックス

## 用語の定義

- サブスクライバー
  - AppViewに登録したアカウント
  - 変数名の例：`subscriber`
- 招待コード
  - AppViewが発行し、subscriptionの作成時にレコードに含める
  - 形式は`{AppViewドメインをケバブケースにした文字列}-{ランダムな5文字}`
  - 変数名の例：`inviteCode`

## アカウントの登録からタイムラインが見れるようになるまで

1. AppViewの管理者が招待コードを発行する
2. ユーザーが招待コードをつけてme.subsco.sync.subscribeServerへリクエスト
3. 招待コードが有効な場合、AppView上にユーザーが登録されサブスクライバーになる
4. サブスクライバーのDIDをTapの`repos/add`エンドポイントに登録
5. Tapがサブスクライバーのアカウント履歴を自動バックフィルし、レコードイベントとして送信
6. AppViewがイベントを受信・処理し、フォロー関係を含むレコード情報がDBに保存される
7. フォローレコードから判明したフォロイーのDIDもTapに登録
8. 登録されたフォロイーの履歴もTapが自動バックフィルして送信
9. Tapから送信される全イベントをリアルタイムでインデックス
10. app.bsky.feed.getTimelineがタイムラインを返すようになる
